# ============================================================================
# TMUX CONFIGURATION - Standalone & Neovim Compatible
# ============================================================================

# ----------------------------------------------------------------------------
# GENERAL SETTINGS
# ----------------------------------------------------------------------------

# Enable true color support
set-option -sa terminal-overrides ",xterm*:Tc"
set -g default-terminal "screen-256color"

# Enable mouse support
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on
# don't rename windows automatically
set-option -g allow-rename off
# Increase scrollback buffer size
set -g history-limit 50000

# Display tmux messages for 4 seconds
set -g display-time 4000

# Refresh status-left and status-right more often
set -g status-interval 5

# Focus events enabled for terminals that support them
set -g focus-events on

# Enable pane synchronization (run commands in all panes simultaneously)
# Prefix + e : Toggle synchronized input across panes
bind e setw synchronize-panes

# Visual feedback for activity/monitor
setw -g monitor-activity on
set -g visual-activity off

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# Enable automatic restore of session state
set -g @restore-session 'true'

# Faster command sequences
set -s escape-time 0

# ----------------------------------------------------------------------------
# KEY BINDINGS - BASIC SETUP
# ----------------------------------------------------------------------------

# Set prefix to Ctrl+b
unbind C-a
set -g prefix C-b
bind C-b send-prefix

# Reload configuration - Prefix + r
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# ----------------------------------------------------------------------------
# WINDOW NAVIGATION - VS CODE STYLE
# ----------------------------------------------------------------------------

# Alt+1-9 to switch windows (like VS Code)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# Ctrl+Tab / Ctrl+Shift+Tab to cycle terminals (like VS Code)
bind -n C-Tab next-window
bind -n C-S-Tab previous-window

# Prefix + t : Rename window
bind t command-prompt -I "#W" { rename-window -t "#{window_id}" "%%" }

# ----------------------------------------------------------------------------
# COPY MODE - IMPROVED FOR VS CODE-LIKE EXPERIENCE
# ----------------------------------------------------------------------------

# Enable vi mode
setw -g mode-keys vi

# Copy mode key bindings - VS Code inspired
# Prefix + [ : Enter copy mode
# v : Begin selection
# y : Copy selection
# / : Search forward
# ? : Search backward
# o : Go to other end of selection
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi r send-keys -X toggle-selection
bind -T copy-mode-vi o send-keys -X other-end
bind -T copy-mode-vi / send-keys -X search-forward
bind -T copy-mode-vi ? send-keys -X search-backward

# Mouse selection copies to clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi WheelUpPane select-pane -t = \; send-keys -X -N 6 scroll-up
bind -T copy-mode-vi WheelDownPane select-pane -t = \; send-keys -X -N 6 scroll-down

# Copy to clipboard using xclip/xsel if available
# Prefix + C-c : Copy selection to system clipboard
bind C-c run "tmux save-buffer - | xclip -i -selection clipboard" \; display "Copied to clipboard!"

# Paste from clipboard - Prefix + C-v
bind C-v run "tmux set-buffer \"$(xclip -o -selection clipboard)\"; tmux paste-buffer"

# ----------------------------------------------------------------------------
# PANE MANAGEMENT - VS CODE STYLE
# ----------------------------------------------------------------------------

# Split panes using | and - (more intuitive)
unbind '"'
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Open new window in current path
bind c new-window -c "#{pane_current_path}"

# Pane navigation - Vi-style (h, j, k, l)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Alt+arrows for pane navigation (like VS Code terminal switching)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Pane resizing - Vi-style with Shift
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Prefix + z : Toggle pane zoom (maximize/restore)
# (default binding)

# Close pane
# Prefix + x : Kill current pane

# ----------------------------------------------------------------------------
# SESSION MANAGEMENT
# ----------------------------------------------------------------------------

# Default session bindings:
# Prefix + d : Detach from session
# Prefix + s : List/choose sessions (native tmux)
# Prefix + $ : Rename session (native tmux)
# Prefix + ( : Previous session (native tmux)
# Prefix + ) : Next session (native tmux)

# Enhanced session management using session-manager.sh
# Location: ~/.config/tmux/bin/session-manager.sh
# Prefix + q : Kill current session with confirmation
bind q confirm-before -p "Kill session #S? (y/n)" kill-session

# Prefix + M-l : Snapshot current session state
bind M-l run-shell "~/.config/tmux/bin/session-manager.sh snapshot"

# ----------------------------------------------------------------------------
# PROJECT WORKFLOW SHORTCUTS
# ----------------------------------------------------------------------------


# Kill window
# Prefix + w : Kill current window
bind w kill-window
# Prefix + Space : Cycle to next layout
bind Space next-layout
# Theme configuration (set before loading the theme)
set -g @catppuccin_flavor "mocha"
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_status_background "default"

# Status bar modules
set -g @catppuccin_status_modules_right "directory session"
set -g @catppuccin_status_modules_left ""

# Window default format
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_text "#W"

# Directory module settings
set -g @catppuccin_directory_text "#{pane_current_path}"

# Load Catppuccin theme
# To install: mkdir -p ~/.config/tmux/plugins/catppuccin && \
#             git clone -b v2.1.3 https://github.com/catppuccin/tmux.git ~/.config/tmux/plugins/catppuccin/tmux
run '~/.config/tmux/plugins/catppuccin/tmux/catppuccin.tmux'
