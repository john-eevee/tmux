# ============================================================================
# TMUX CONFIGURATION - Standalone & Neovim Compatible
# ============================================================================

# ----------------------------------------------------------------------------
# GENERAL SETTINGS
# ----------------------------------------------------------------------------

# Enable true color support
set-option -sa terminal-overrides ",xterm*:Tc"
set -g default-terminal "screen-256color"

# Enable mouse support
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on
# don't rename windows automatically
set-option -g allow-rename off
# Increase scrollback buffer size
set -g history-limit 50000

# Display tmux messages for 4 seconds
set -g display-time 4000

# Refresh status-left and status-right more often
set -g status-interval 5

# Focus events enabled for terminals that support them
set -g focus-events on

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# Faster command sequences
set -s escape-time 0

# ----------------------------------------------------------------------------
# KEY BINDINGS - DOCUMENTED
# ----------------------------------------------------------------------------

# Set prefix to Ctrl+a
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Reload configuration
# Prefix + r : Reload tmux config
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# ----------------------------------------------------------------------------
# WINDOW MANAGEMENT
# ----------------------------------------------------------------------------

# Create new windows
# Prefix + c : Create new window
# (default binding, kept for reference)

# Window navigation
# Prefix + n : Next window
# Prefix + p : Previous window
# Prefix + 0-9 : Jump to window number
# (default bindings, kept for reference)

# Prefix + , : Rename current window
# (default binding, kept for reference)

# Prefix + t : Rename window (alternative keybind)
bind t command-prompt -I "#W" { rename-window -t "#{window_id}" "%%" }

# ----------------------------------------------------------------------------
# PANE MANAGEMENT - NEOVIM COMPATIBLE
# ----------------------------------------------------------------------------

# Split panes using | and - (more intuitive)
# Prefix + | : Split horizontally
# Prefix + - : Split vertically
unbind '"'
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Open new window in current path
bind c new-window -c "#{pane_current_path}"

# Pane navigation - Vi-style (h, j, k, l)
# Prefix + h : Move to left pane
# Prefix + j : Move to down pane
# Prefix + k : Move to up pane
# Prefix + l : Move to right pane
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing - Vi-style with Shift
# Prefix + H : Resize pane left
# Prefix + J : Resize pane down
# Prefix + K : Resize pane up
# Prefix + L : Resize pane right
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Maximize/minimize pane
# Prefix + z : Toggle pane zoom (maximize/restore)
# (default binding, kept for reference)

# Close pane
# Prefix + x : Kill current pane
# (default binding, kept for reference)

# ----------------------------------------------------------------------------
# COPY MODE - VI BINDINGS (NEOVIM COMPATIBLE)
# ----------------------------------------------------------------------------

# Enable vi mode
setw -g mode-keys vi

# Copy mode key bindings
# Prefix + [ : Enter copy mode
# v : Begin selection (in copy mode)
# y : Copy selection (in copy mode)
# Prefix + ] : Paste
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle

# Mouse selection copies to clipboard
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection-and-cancel

# ----------------------------------------------------------------------------
# SESSION MANAGEMENT
# ----------------------------------------------------------------------------

# Prefix + d : Detach from session
# Prefix + s : List sessions
# Prefix + $ : Rename session
# (default bindings, kept for reference)

# Quick session switching
# Prefix + ( : Previous session
# Prefix + ) : Next session
# (default bindings, kept for reference)

# Create/switch to project session
# Prefix + C : Create new project session (interactive)
bind C command-prompt -p "Project name:" { new-session -d -s "%%" -x 200 -y 50 }

# Kill session
# Prefix + q : Kill current session
bind q confirm-before -p "Kill session #S? (y/n)" kill-session

# List and switch sessions (prefix + s is default)
# For quick project switching: Prefix + s then select

# ----------------------------------------------------------------------------
# PROJECT WORKFLOW SHORTCUTS
# ----------------------------------------------------------------------------

# Setup new project with dev layout
# Creates 3 windows: editor, terminal, logs
# Prefix + P : New project layout
bind P run-shell "
  if [ -z '#{session_name}' ]; then
    tmux new-session -d -s 'dev' -x 200 -y 50
  fi
  tmux new-window -t '#{session_name}' -n 'edit' -c '#{pane_current_path}'
  tmux new-window -t '#{session_name}' -n 'build' -c '#{pane_current_path}'
  tmux new-window -t '#{session_name}' -n 'logs' -c '#{pane_current_path}'
  tmux select-window -t '#{session_name}:1'
"

# Quick editor window setup
# Prefix + e : New neovim editor window
bind e new-window -n 'editor' -c '#{pane_current_path}' 'nvim'

# Quick terminal window setup
# Prefix + t (already used for rename, see above)
# Prefix + T : New plain terminal window (auto-named: term1, term2, etc)
bind T command-prompt -p "Window name (default: term):" { new-window -c "#{pane_current_path}" -n "%%" }

# Quick build/tools window
# Prefix + b : New build/tools window (auto-named: build1, build2, etc)
bind b command-prompt -p "Window name (default: build):" { new-window -c "#{pane_current_path}" -n "%%" }

# Quick logs window
# Prefix + g : New logs window (auto-named: logs1, logs2, etc)
bind g command-prompt -p "Window name (default: logs):" { new-window -c "#{pane_current_path}" -n "%%" }

# Kill window
# Prefix + w : Kill current window
bind w kill-window

# Dynamic "add tool window" - prompts for name and optional command
# Prefix + a : Add new named window with optional startup command
bind a command-prompt -p "Window name:" { 
  new-window -n "%%" -c "#{pane_current_path}"
}

# Alternative: Quick numbered tool windows (no prompts, just increment)
# Prefix + Alt+t : Auto-create next tool window (tool1, tool2, tool3...)
bind M-t run-shell '
  WINCOUNT=$(tmux list-windows -t "#{session_name}" | wc -l)
  NEXT_NUM=$((WINCOUNT))
  tmux new-window -t "#{session_name}" -n "tool$NEXT_NUM" -c "#{pane_current_path}"
'

# Rename current window (t is for "title")
# Already mapped at line 72

# ----------------------------------------------------------------------------
# LAYOUTS - PREDEFINED CONFIGURATIONS
# ----------------------------------------------------------------------------

# Prefix + L : Show layout menu (interactive selection)
bind L display-menu -T "Select Layout" \
    "1. Main Vertical (1 left, 2 right)"        1 "select-layout main-vertical" \
    "2. Main Horizontal (1 top, 3 bottom)"      2 "select-layout main-horizontal" \
    "3. Tiled (equal panes)"                    3 "select-layout tiled" \
    "4. Even Vertical (equal columns)"          4 "select-layout even-vertical" \
    "5. Even Horizontal (equal rows)"           5 "select-layout even-horizontal" \
    "" \
    "Dev: Code + Terminal + Logs"               d "run-shell 'tmux select-layout main-vertical && tmux resize-pane -t 1 -x 60%'" \
    "Grid: 4-pane grid"                         g "select-layout tiled" \
    "Focus: Single maximized pane"              f "resize-pane -Z"

# Quick layout shortcuts
# Prefix + 1 : Main vertical (1 large left, stacked right)
# Prefix + 2 : Main horizontal (1 large top, stacked bottom)
# Prefix + 3 : Tiled (all panes equal)
# Prefix + 4 : Even vertical (columns)
# Prefix + 5 : Even horizontal (rows)
bind 1 select-layout main-vertical
bind 2 select-layout main-horizontal
bind 3 select-layout tiled
bind 4 select-layout even-vertical
bind 5 select-layout even-horizontal

# Cycle through layouts
# Prefix + Space : Cycle to next layout
bind Space next-layout

# ----------------------------------------------------------------------------
# CATPPUCCIN MOCHA THEME
# ----------------------------------------------------------------------------

# Theme configuration (set before loading the theme)
set -g @catppuccin_flavor "mocha"
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_status_background "default"

# Status bar modules
set -g @catppuccin_status_modules_right "directory session"
set -g @catppuccin_status_modules_left ""

# Window default format
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_text "#W"

# Directory module settings
set -g @catppuccin_directory_text "#{pane_current_path}"

# Load Catppuccin theme
# To install: mkdir -p ~/.config/tmux/plugins/catppuccin && \
#             git clone -b v2.1.3 https://github.com/catppuccin/tmux.git ~/.config/tmux/plugins/catppuccin/tmux
run '~/.config/tmux/plugins/catppuccin/tmux/catppuccin.tmux'

# ----------------------------------------------------------------------------
# QUICK REFERENCE
# ----------------------------------------------------------------------------
# Prefix: C-a (Ctrl + a)
#
# WINDOWS (wezterm tabs = projects, tmux windows = tools/editor):
#   c       - Create window (prompts for name)
#   ,       - Rename window
#   t       - Rename window (alternative)
#   e       - New neovim editor window
#   T       - New terminal window (prompts for name)
#   b       - New build/tools window (prompts for name)
#   g       - New logs window (prompts for name)
#   a       - Add new named window (flexible alternative)
#   M-t     - Auto-create numbered tool window (tool1, tool2, ...)
#   w       - Kill current window
#   n/p     - Next/Previous window
#   0-9     - Jump to window number
#
# PANES (subdivisions within windows):
#   |       - Split horizontal
#   -       - Split vertical
#   h/j/k/l - Navigate left/down/up/right
#   H/J/K/L - Resize left/down/up/right
#   z       - Toggle zoom
#   x       - Kill pane
#   q       - Show pane numbers
#
# SESSIONS (per-project, one per wezterm tab):
#   d       - Detach from session
#   s       - List/switch sessions
#   $       - Rename session
#   C       - Create new project session
#   q       - Kill session
#   (/)     - Previous/Next session
#
# LAYOUTS:
#   L       - Show layout menu
#   Space   - Cycle layouts
#   1/2/3/4/5 - Quick layout selection
#
# COPY MODE:
#   [       - Enter copy mode
#   v       - Begin selection
#   y       - Copy selection
#   ]       - Paste
#   q       - Quit copy mode
#
# OTHER:
#   r       - Reload config
#   ?       - List all keybindings
#
# WORKFLOW EXAMPLE:
# 1. Open wezterm, create new tab for project (Ctrl+a c in wezterm)
# 2. tmux new-session -s myproject OR Ctrl+a C in tmux
# 3. Create windows: editor (Ctrl+a e), build (Ctrl+a b), logs (Ctrl+a g)
# 4. Navigate windows: Ctrl+a n/p or Ctrl+a 0-9
# 5. In each window, split panes as needed (Ctrl+a | or Ctrl+a -)
# 6. Edit in nvim, build in separate window, tail logs in another
# 7. Switch projects: Ctrl+a s to list sessions, or detach/attach
# 8. Detach: Ctrl+a d (stays running, reconnect later)
# ----------------------------------------------------------------------------
